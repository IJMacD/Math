Array.prototype.remove=function(d,c){var a=this.slice((c||d)+1||this.length);this.length=d<0?this.length+d:d;return this.push.apply(this,a)};(function(){$(function(){var m=["Chainset","Sprocket","Wheelsize","Cranksize"],d={tdf:[[52,39],[12,13,15,17,19,21,23,26],336,170,"Carrera Tdf","rgb(255,255,0)","rgb(0,0,0)"],triban3:[[50,39,30],[12,13,15,17,19,21,23,25],336,170,"B'twin Triban 3","rgb(255,0,0)","rgb(96,0,0)"],I1:[[38],[16],312,170,"I1","rgb(192,192,255)","rgb(192,192,192)"],I2:[[52,42],[12,13,15,17,19,21,23,26],336,170,"I2","rgb(255,255,0)","rgb(0,0,0)"],supersix:[[53,39],[11,12,13,14,15,16,17,19,21,23,25],336,170,"Cannondale Supersix Evo","rgb(128,128,128)","rgb(0,0,0)"],nukeproof:[[36],[11,12,13,14,15,17,19,21,23,26],330,170,"Nukeproof Snap Comp","rgb(202,202,202)","rgb(40,40,40)"]},o={nexus7:[0.632,0.741,0.843,0.989,1.145,1.335,1.545],alfine11:[0.527,0.681,0.77,0.878,0.995,1.134,1.292,1.462,1.667,1.888,2.153],rohloff14:[0.279,0.316,0.36,0.409,0.464,0.528,0.6,0.682,0.774,0.881,1,1.135,1.292,1.467]},g=0,e=m.length,p=$("#builtin_rad"),h=$("#specified_rad"),j=$("#builtin_lst"),k=$("#tooltips"),c=[],a=$("canvas")[0],s=a.getContext("2d");d.I1.gearhub=[0.632,0.741,0.843,0.989,1.145,1.335,1.545];for(;g<e;g++){(function(){var t=m[g].toLowerCase(),l=$("#"+t+"_lst"),i=$("#"+t+"_txt");$("a[href=#custom"+m[g]+"]").click(function(){$(this).hide();l.hide();i.val(l.val());i.show();f()})})()}$("a[href=#gearhub]").click(function(){var l=$("#sprocket_lst"),i=$("#sprocket_txt"),t=$("#gearhub_lst");val=i.val()||l.val();l.hide();$(this).hide();$("a[href=#customSprocket]").hide();f();val=val.split(" ")[0];i.val(val);i.css({width:"30px"}).show();t.css({width:"170px"}).show()});for(b in d){$("<option>").attr("value",b).text(d[b][4]).appendTo(j)}function q(){p.attr("checked","checked");h.removeAttr("checked")}function f(){p.removeAttr("checked");h.attr("checked","checked")}function n(){var B,w=c.length,C,A,z,v,u,F=0,t,I,H,E,G,D;a.height=w*50+50;k.empty();k[0].style.top=a.offsetTop+"px";k[0].style.left=a.offsetLeft+"px";for(B=0;B<w;B++){C=r(c[B]);D=C.length;F=Math.max(F,C[D-1][C[D-1].length-1])}t=(a.width-20)/F;I=Math.floor(F);s.strokeStyle="rgb(192,192,192)";s.fillStyle="rgb(192,192,192)";s.font="12px sans-serif";for(B=1;B<=I;B++){s.beginPath();s.moveTo(B*t,0);s.lineTo(B*t,a.height);s.stroke();s.fillText(B,B*t,12);s.fillText(B,B*t,a.height)}s.font="16px sans-serif";for(B=0;B<w;B++){C=r(c[B]);v=C.length;E=50+B*50;s.strokeStyle="rgb(255,255,255)";s.fillStyle="rgb(0,0,0)";s.lineWidth=4;s.strokeText(c[B][4],30,E);s.fillText(c[B][4],30,E);(function(){var l=B,x=$("<p>").addClass("removeBike").css({left:"10px",top:(E-16)+"px"}).appendTo(k),i=$("<a>").text("×").click(function(){c.remove(l);n()}).appendTo(x);x.hover(function(){i.show()},function(){i.hide()})})();if(c[B][5]){s.fillStyle=c[B][5]}for(A=0;A<v;A++){u=C[A].length;for(z=0;z<u;z++){H=C[A][z]*t;E=50+B*50+(v-A-1)*10;s.beginPath();s.arc(H,E,5,0,Math.PI*2,true);s.fill();if(c[B][6]){s.lineWidth=2;s.strokeStyle=c[B][6];s.stroke()}if(typeof c[B].gearhub=="undefined"){G=c[B][0][v-A-1]+"×"+c[B][1][u-z-1]}else{G=c[B][0][v-A-1]+"×"+c[B][1][0]+"("+(z+1)+")"}$("<a>").attr("title",G).css({left:(H-5)+"px",top:(E-5)+"px"}).tooltip().popover({content:"Bike: "+c[B][4]+"<br>Gear: "+(c[B].gearhub?(z+1):(A+1)+","+(z+1))+"<br>Wheelsize: "+(c[B][2]*2).toFixed()+" mm<br>Crank Length: "+c[B][3].toFixed()+" mm<br>Ratio: "+C[A][z].toFixed(2),html:true}).appendTo(k)}}}}function r(E){var y=[],v,A=0,z=0,x=E[0].length,w,F=E[3],D=E[2],C,u,t=D/F,B;for(A=x-1;A>=0;A--){if(E.gearhub){v=[];w=E.gearhub.length;C=E[0][A];u=E[1][0];for(z=0;z<w;z++){B=E.gearhub[z];v.push(t*(C/u)*B)}y.push(v)}else{v=[];w=E[1].length;C=E[0][A];for(z=w-1;z>=0;z--){u=E[1][z];v.push(t*(C/u))}y.push(v)}}return y}j.click(q).change(q);$("#specify input, #specify select").click(f).change(f);$("#addbike_btn").click(function(){$("#addbike_modal").modal("hide");if(p[0].checked){c.push(d[j.val()]);n()}else{var A=function(){return(Math.random()*256).toFixed()},u=$("#chainset_txt").val(),y=$("#sprocket_txt").val(),t=$("#wheelsize_txt").val(),v=$("#cranksize_txt").val(),l=$("#gearhub_lst"),i=$("#name_txt").val(),x="rgb("+A()+","+A()+","+A()+")",w="rgb("+A()+","+A()+","+A()+")",z;if(!u){u=$("#chainset_lst").val()}if(!y){y=$("#sprocket_lst").val()}if(!t){t=$("#wheelsize_lst").val()}if(!v){v=$("#cranksize_lst").val()}if(!i){i="bike"+(Math.random()*10000).toFixed()}u=u.split(" ");y=y.split(" ");t=t/2;v=v*1;z=[u,y,t,v,i,w,x];if(l[0].style.display!=""&&l[0].style.display!="none"){z.gearhub=o[l.val()]}c.push(z);n()}});$(window).resize(n)})})();