Array.prototype.remove=function(d,c){var a=this.slice((c||d)+1||this.length);this.length=d<0?this.length+d:d;return this.push.apply(this,a)};(function(){$(function(){var m=["Chainset","Sprocket","Wheelsize","Cranksize"],d={tdf:[[52,39],[12,13,15,17,19,21,23,26],336,170,"Carrera Tdf","rgb(255,255,0)","rgb(0,0,0)"],triban3:[[50,39,30],[12,13,15,17,19,21,23,25],336,170,"B'twin Triban 3","rgb(255,0,0)","rgb(96,0,0)"],I1:[[38],[16],311,170,"I1","rgb(192,192,255)","rgb(192,192,192)"],I2:[[52,42],[12,13,15,17,19,21,23,26],336,170,"I2","rgb(255,255,0)","rgb(0,0,0)"],supersix:[[53,39],[11,12,13,14,15,16,17,19,21,23,25],336,170,"Cannondale Supersix Evo","rgb(128,128,128)","rgb(0,0,0)"],nukeproof:[[36],[11,12,13,14,15,17,19,21,23,26],330,170,"Nukeproof Snap Comp","rgb(202,202,202)","rgb(40,40,40)"]},g=0,e=m.length,o=$("#builtin_rad"),h=$("#specified_rad"),j=$("#builtin_lst"),k=$("#tooltips"),c=[],a=$("canvas")[0],r=a.getContext("2d");for(;g<e;g++){(function(){var s=m[g].toLowerCase(),l=$("#"+s+"_lst"),i=$("#"+s+"_txt");$("a[href=#custom"+m[g]+"]").click(function(){$(this).hide();l.hide();i.val(l.val());i.show();f()})})()}for(b in d){$("<option>").attr("value",b).text(d[b][4]).appendTo(j)}function p(){o.attr("checked","checked");h.removeAttr("checked")}function f(){o.removeAttr("checked");h.attr("checked","checked")}function n(){var A,v=c.length,B,z,w,u,t,D=0,s,F,E,C;a.height=v*50+50;k.empty();k[0].style.top=a.offsetTop+"px";k[0].style.left=a.offsetLeft+"px";for(A=0;A<v;A++){B=q(c[A]);u=B.length;for(z=0;z<u;z++){D=Math.max(D,B[z][0])}}s=(a.width-20)/D;F=Math.floor(D);r.strokeStyle="rgb(192,192,192)";r.fillStyle="rgb(192,192,192)";r.font="12px sans-serif";for(A=1;A<=F;A++){r.beginPath();r.moveTo(A*s,0);r.lineTo(A*s,a.height);r.stroke();r.fillText(A,A*s,12);r.fillText(A,A*s,a.height)}r.font="16px sans-serif";for(A=0;A<v;A++){B=q(c[A]);u=B.length;C=50+A*50;r.strokeStyle="rgb(255,255,255)";r.fillStyle="rgb(0,0,0)";r.lineWidth=4;r.strokeText(c[A][4],30,C);r.fillText(c[A][4],30,C);(function(){var l=A,x=$("<p>").addClass("removeBike").css({left:"10px",top:(C-16)+"px"}).appendTo(k),i=$("<a>").text("Ã—").click(function(){c.remove(l);n()}).appendTo(x);x.hover(function(){i.show()},function(){i.hide()})})();if(c[A][5]){r.fillStyle=c[A][5]}for(z=0;z<u;z++){t=B[z].length;for(w=0;w<t;w++){E=B[z][w]*s;C=50+A*50+(u-z-1)*10;r.beginPath();r.arc(E,C,5,0,Math.PI*2,true);r.fill();if(c[A][6]){r.lineWidth=2;r.strokeStyle=c[A][6];r.stroke()}$("<a>").attr("title",c[A][0][z]+"x"+c[A][1][w]).css({left:(E-5)+"px",top:(C-5)+"px"}).tooltip().appendTo(k)}}}}function q(B){var w=[],t,y=0,x=0,v=B[0].length,u=B[1].length,C=B[3],A=B[2],z,s;for(;y<v;y++){t=[];for(x=0;x<u;x++){z=B[0][y];s=B[1][x];t.push((A/C)*(z/s))}w.push(t)}return w}j.click(p).change(p);$("#specify input, #specify select").click(f).change(f);$("#addbike_btn").click(function(){$("#addbike_modal").modal("hide");if(o[0].checked){c.push(d[j.val()]);n()}else{var v=function(){return(Math.random()*256).toFixed()},x=$("#chainset_txt").val(),i=$("#sprocket_txt").val(),u=$("#wheelsize_txt").val(),w=$("#cranksize_txt").val(),t=$("#name_txt").val(),s="rgb("+v()+","+v()+","+v()+")",l="rgb("+v()+","+v()+","+v()+")";if(!x){x=$("#chainset_lst").val()}if(!i){i=$("#sprocket_lst").val()}if(!u){u=$("#wheelsize_lst").val()}if(!w){w=$("#cranksize_lst").val()}if(!t){t="bike"+(Math.random()*10000).toFixed()}x=x.split(" ");i=i.split(" ");u=u/2;c.push([x,i,u,w,t,l,s]);n()}});$(window).resize(n)})})();