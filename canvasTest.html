<html>
<script>
(function(){
	function drawCircle(ctx, x, y, r){
		ctx.beginPath();
		ctx.arc(x, y, r, 0, Math.PI * 2);
	}
	function drawEllipse(ctx, x, y, xr, yr){
	  var kappa = .5522848;
		  ox = xr * kappa, // control point offset horizontal
		  oy = yr * kappa, // control point offset vertical
		  xe = x + xr;       // x-end
		  ye = y + yr,       // y-end
		  xs = x - xr,       // x-start
		  ys = y - yr;       // y-start

	  ctx.beginPath();
	  ctx.moveTo(xs, y);
	  ctx.bezierCurveTo(xs, y - oy, x - ox, ys, x, ys);
	  ctx.bezierCurveTo(x + ox, ys, xe, y - oy, xe, y);
	  ctx.bezierCurveTo(xe, y + oy, x + ox, ye, x, ye);
	  ctx.bezierCurveTo(x - ox, ye, xs, y + oy, xs, y);
	  ctx.closePath();
	}
	CanvasRenderingContext2D.prototype.strokeCircle = function(x, y, radius){
		drawCircle(this, x, y, radius);
		this.stroke();
	};
	CanvasRenderingContext2D.prototype.fillCircle = function(x, y, radius){
		drawCircle(this, x, y, radius);
		this.fill();
	};
	CanvasRenderingContext2D.prototype.strokeEllipse = function(x, y, xr, yr) {
		drawEllipse(this, x, y, xr, yr);
		this.stroke();
	}
	CanvasRenderingContext2D.prototype.fillEllipse = function(x, y, xr, yr) {
		drawEllipse(this, x, y, xr, yr);
		this.fill();
	}
})();
window.onload = function(){
	Function.prototype.extend = function() {
		function Class() {
			if (!(this instanceof Class))
				throw('Constructor called without "new"');
			if ('_init' in this)
				this._init.apply(this, arguments);
		}
		Function.prototype.extend.nonconstructor.prototype = this.prototype;
		Class.prototype = new Function.prototype.extend.nonconstructor();
		return Class;
	};
	Function.prototype.extend.nonconstructor= function() {};
	var GameObject = Object.extend();
	GameObject.prototype._init = function(x, y){
		this.components = [];
		this.x = x;
		this.y = y;
		this.vx = 0.01;
		this.vy = 0.01;
	};
	GameObject.prototype.addComponent = function(component){
		if(component instanceof GameComponent)
			this.components.push(component);
	};
	GameObject.prototype.update = function(delta){
		var i = 0,
			l = this.components.length;
		for(;i<l;i++)
			this.components[i].update(this, delta);
	};
	var GameObjectManager = GameObject.extend();
	GameObjectManager.prototype._init = function(){
		this.objects = [];
	};
	GameObjectManager.prototype.addObject = function(object){
		if(object instanceof GameObject)
			this.objects.push(object);
	};
	GameObjectManager.prototype.update = function(delta){
		var i = 0,
			l = this.objects.length;
		for(;i<l;i++)
			this.objects[i].update(delta);
	};
	var CanvasManager = GameObject.extend();
	CanvasManager.prototype._init = function(context){
		this.context = context;
	};
	CanvasManager.prototype.update = function(delta){
		this.context.fillStyle = "#fff";
		this.context.fillRect(0,0,400,400);
	}
	var GameComponent = Object.extend();
	GameComponent.prototype.update = function(parent, delta){};
	var MoveComponent = GameComponent.extend();
	MoveComponent.prototype.update = function(parent, delta) {
		if(parent.vx)
			parent.x += parent.vx * delta;
		if(parent.vy)
			parent.y += parent.vy * delta;
	};
	var DrawComponent = GameComponent.extend();
	DrawComponent.prototype._init = function(context){
		this.context = context;
	};
	DrawComponent.prototype.update = function(parent, delta) {
		this.context.fillStyle = "#f00";
		this.context.fillCircle(parent.x,parent.y,20);
	};

	var ctx = document.getElementsByTagName('canvas')[0].getContext('2d'),
		gameRoot = new GameObjectManager(),
		redBall = new GameObject(20, 20),
		mc = new MoveComponent(),
		dc = new DrawComponent(ctx);
	redBall.addComponent(mc);
	redBall.addComponent(dc);
	gameRoot.addObject(new CanvasManager(ctx));
	gameRoot.addObject(redBall);

	var lastTime = 0;
	function loop(t){
		gameRoot.update(t - lastTime);
		lastTime = t;
		requestAnimationFrame(loop);
	}
	requestAnimationFrame(loop);
}
</script>
<canvas height="400" width="400"></canvas>
</html>