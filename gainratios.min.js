Array.prototype.remove=function(d,c){var a=this.slice((c||d)+1||this.length);this.length=d<0?this.length+d:d;return this.push.apply(this,a)};$(function(){var h=["Chainset","Sprocket","Wheelsize","Cranksize"],t={tdf:[[52,39],[12,13,15,17,19,21,23,26],336,170,"Carrera Tdf","rgb(255,255,0)","rgb(0,0,0)"],triban3:[[50,39,30],[12,13,15,17,19,21,23,25],336,170,"B'twin Triban 3","rgb(255,0,0)","rgb(96,0,0)"],I1:[[38],[16],312,170,"I1","rgb(192,192,255)","rgb(192,192,192)"],I2:[[52,42],[12,13,15,17,19,21,23,26],336,170,"I2","rgb(255,255,0)","rgb(0,0,0)"],supersix:[[53,39],[11,12,13,14,15,16,17,19,21,23,25],336,170,"Cannondale Supersix Evo","rgb(128,128,128)","rgb(0,0,0)"],nukeproof:[[36],[11,12,13,14,15,17,19,21,23,26],330,170,"Nukeproof Snap Comp","rgb(202,202,202)","rgb(40,40,40)"]},a={nexus7:[0.632,0.741,0.843,0.989,1.145,1.335,1.545],alfine11:[0.527,0.681,0.77,0.878,0.995,1.134,1.292,1.462,1.667,1.888,2.153],rohloff14:[0.279,0.316,0.36,0.409,0.464,0.528,0.6,0.682,0.774,0.881,1,1.135,1.292,1.467]},u=0,s=h.length,f=$("#builtin_rad"),w=$("#specified_rad"),p=$("#builtin_lst"),c=$("#tooltips"),k=[],q=[],d=0,j=$("canvas")[0],r=j.getContext("2d"),n=0;t.I1.gearhub=[0.632,0.741,0.843,0.989,1.145,1.335,1.545];for(;u<s;u++){(function(){var A=h[u].toLowerCase(),l=$("#"+A+"_lst"),i=$("#"+A+"_txt");$("a[href=#custom"+h[u]+"]").click(function(){$(this).hide();l.hide();i.val(l.val());i.show();e()})})()}$("a[href=#gearhub]").click(function(){var l=$("#sprocket_lst"),i=$("#sprocket_txt"),A=$("#gearhub_lst");val=i.val()||l.val();l.hide();$(this).hide();$("a[href=#customSprocket]").hide();e();val=val.split(" ")[0];i.val(val);i.css({width:"30px"}).show();A.css({width:"170px"}).show()});for(b in t){$("<option>").attr("value",b).text(t[b][4]).appendTo(p)}function o(){f.attr("checked","checked");w.removeAttr("checked")}function e(){f.removeAttr("checked");w.attr("checked","checked")}function y(){var G,D=k.length,F,E,C,B,A,L,K,I,J,H;if(!n){j.height=D*50+50}c.empty();c[0].style.top=j.offsetTop+"px";c[0].style.left=j.offsetLeft+"px";A=(j.width-20)/d;L=Math.floor(d);r.strokeStyle="rgb(192,192,192)";r.fillStyle="rgb(192,192,192)";r.font="12px sans-serif";for(G=1;G<=L;G++){r.beginPath();r.moveTo(G*A,0);r.lineTo(G*A,j.height);r.stroke();r.fillText(G,G*A,12);r.fillText(G,G*A,j.height)}r.font="16px sans-serif";for(G=0;G<D;G++){C=q[G].length;I=50+G*50;r.strokeStyle="rgb(255,255,255)";r.fillStyle="rgb(0,0,0)";r.lineWidth=4;r.strokeText(k[G][4],30,I);r.fillText(k[G][4],30,I);(function(){var l=G,M=$("<p>").addClass("removeBike").css({left:"10px",top:(I-16)+"px"}).appendTo(c),i=$("<a>").text("×").click(function(){z(l)}).appendTo(M);M.hover(function(){i.show()},function(){i.hide()})})();if(k[G][5]){r.fillStyle=k[G][5]}for(F=0;F<C;F++){B=q[G][F].length;for(E=0;E<B;E++){K=q[G][F][E]*A;I=50+G*50+(C-F-1)*10;r.beginPath();r.arc(K,I,5,0,Math.PI*2,true);r.fill();if(k[G][6]){r.lineWidth=2;r.strokeStyle=k[G][6];r.stroke()}if(typeof k[G].gearhub=="undefined"){J=k[G][0][C-F-1]+"×"+k[G][1][B-E-1]}else{J=k[G][0][C-F-1]+"×"+k[G][1][0]+"("+(E+1)+")"}if(!n){$("<a>").attr("title",J).css({left:(K-5)+"px",top:(I-5)+"px"}).tooltip().popover({content:"Bike: "+k[G][4]+"<br>Gear: "+(k[G].gearhub?(E+1):(F+1)+","+(E+1))+"<br>Wheelsize: "+(k[G][2]*2).toFixed()+" mm<br>Crank Length: "+k[G][3].toFixed()+" mm<br>Ratio: "+q[G][F][E].toFixed(2),html:true}).appendTo(c)}}}}}function g(L){var F=[],C,H=0,G=0,E=L[0].length,D,M=L[3],K=L[2],J,B,A=K/M,I;for(H=E-1;H>=0;H--){if(L.gearhub){C=[];D=L.gearhub.length;J=L[0][H];B=L[1][0];for(G=0;G<D;G++){I=L.gearhub[G];C.push(A*(J/B)*I)}F.push(C)}else{C=[];D=L[1].length;J=L[0][H];for(G=D-1;G>=0;G--){B=L[1][G];C.push(A*(J/B))}F.push(C)}}return F}p.click(o).change(o);$("#specify input, #specify select").click(e).change(e);$("#addbike_btn").click(function(){$("#addbike_modal").modal("hide");var G;if(f[0].checked){G=t[p.val()]}else{var H=function(){return(Math.random()*256).toFixed()},B=$("#chainset_txt").val(),F=$("#sprocket_txt").val(),A=$("#wheelsize_txt").val(),C=$("#cranksize_txt").val(),l=$("#gearhub_lst"),i=$("#name_txt").val(),E="rgb("+H()+","+H()+","+H()+")",D="rgb("+H()+","+H()+","+H()+")",G;if(!B){B=$("#chainset_lst").val()}if(!F){F=$("#sprocket_lst").val()}if(!A){A=$("#wheelsize_lst").val()}if(!C){C=$("#cranksize_lst").val()}if(!i){i="bike"+(Math.random()*10000).toFixed()}B=B.split(" ");F=F.split(" ");A=A/2;C=C*1;G=[B,F,A,C,i,D,E];if(l[0].style.display!=""&&l[0].style.display!="none"){G.gearhub=a[l.val()]}}x(G)});function x(l){var A=k.length+1,C=q,E=d,i,B={max:d},D=30;k.push(l);v();i=d;k.remove(-1);q=C;d=E;m(j,"height",A*50+50,D,y,function(){k.push(l);v();y()});if(d!=i){m(B,"max",i,D,function(){d=B.max})}}function z(l){var A=k.length-1,C=30,B={max:d},i;k.remove(l);v();if(d!=B.max_ratio){i=d;d=B.max_ratio;m(B,"max",i,C,function(){d=B.max})}m(j,"height",A*50+50,C,y)}function v(){q=[];var D,C=0,B=k.length,A;d=0;for(;C<B;C++){q[C]=D=g(k[C]);A=D.length;d=Math.max(d,D[A-1][D[A-1].length-1])}}function m(D,i,C,E,G,B){if(typeof D[i]!="number"){return false}n++;var A=D[i],F=(C-A)/E,l=(function(){A+=F;D[i]=A;if(typeof G=="function"){G()}if(F>0?A<C:A>C){requestAnimationFrame(l)}else{D[i]=C;if(typeof G=="function"){G()}n--;if(typeof B=="function"){B()}}});requestAnimationFrame(l)}$(window).resize(y)});